# Pnx_dart_vision
## 概述：这个repositories是香港科技大学（广州）PnX战队的飞镖视觉部分代码，主要功能是实现对目标引导灯的识别和解算出灯与画面中心的偏角（yaw轴）
### 已经实现的功能：
1. 实现稳定的锁定画中符合标准的绿灯，具体标准有半径、发光面积、圆度，需要修改的部分位于detector的cpp和hpp文件中，hpp文件中有二值化阈值、半径、发光面积、圆度的设置，cpp文件中isLight函数中的判断阈值也需要对应修改。
2. 实现测量拟合出的圆形绿灯与画面中心的像素偏角，以便于电控调整yaw轴实现两个圆点重合，达到对准效果，并将结果输出到rqt中的result_img节点实现可视化。
3. 实现一阶简单卡尔曼滤波，使用update函数进行小角度稳定，具体阈值在配置文件中，大于阈值则判定为运动状态，不进行update平滑处理，小于阈值则调用update函数进行平滑处理，以应对摄像头抖动问题。
4. 实现使用ros2作为代码框架，并用rqt进行可视化。
5. 实现使用串口与电控进行通讯，收发的消息位于packet.hpp文件中，如果需要增加收发的参数，则需要修改packet.hpp、rm_servial_driver.hpp、rm_servial_driver.cpp、detector_node.hpp、detector_node.cpp。
6. 实现video_reader对赛场情况的内录，非正常下电情况下的视频受损需要用失易得进行修复。
### 存在的问题以及下一步的开发目标：
1. pnp方法解算7、8米以外的距离误差较大，场上经验表明16m经常解算为70多m，后续考虑引入深度相机增加准确性或者使用神经网络等方法增加正确率。
2. 代码结构可进一步优化，增加可读性，tf2转换目前不确定是否能用上，暂时保留。
3. 考虑引入神经网络或者视觉大模型实现对每发镖体的准确识别，可考虑给镖体打上视觉标签，加上小电脑跑模型的方法实现，准确识别后可尝试程序自行判断镖体与靶子之间的偏角，进行自适应调节yaw轴。
4. 改进代码结构，删减冗余代码片段。